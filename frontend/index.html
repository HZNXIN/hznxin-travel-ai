<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Horizon | ç©ºé—´æ™ºèƒ½å†³ç­–ç”»å¸ƒ - é«˜å¾·æ¯”èµ›é¡¹ç›®</title>
    
    <!-- å¼•å…¥ Vue3 å’Œ ECharts -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body { 
            background-color: #0f172a; 
            color: #e2e8f0; 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            padding: 0;
        }
        
        /* éœ“è™¹å…‰æ•ˆ */
        .neon-text { 
            text-shadow: 0 0 10px rgba(59, 130, 246, 0.5); 
        }
        
        /* ç»ç’ƒæ‹Ÿæ€ */
        .glass-panel { 
            background: rgba(30, 41, 59, 0.7); 
            backdrop-filter: blur(10px); 
            border: 1px solid rgba(255,255,255,0.1); 
        }
        
        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar { 
            width: 6px; 
            height: 6px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.5);
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.5);
            border-radius: 3px;
        }
        
        /* æ¸å…¥åŠ¨ç”» */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        
        /* è„‰å†²åŠ¨ç”» */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* å¾½ç« æ ·å¼ */
        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        .badge-green { background: rgba(16, 185, 129, 0.2); color: #10b981; }
        .badge-yellow { background: rgba(251, 191, 36, 0.2); color: #fbbf24; }
        .badge-red { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .badge-blue { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
    </style>
</head>
<body>
    <div id="app" class="h-screen flex flex-col">
        
        <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
        <header class="h-16 border-b border-slate-700 flex items-center justify-between px-6 bg-slate-900/90 backdrop-blur-sm">
            <div class="flex items-center gap-3">
                <div class="w-3 h-3 rounded-full bg-green-500 animate-pulse"></div>
                <h1 class="text-xl font-bold tracking-wider neon-text">
                    Event Horizon 
                    <span class="text-xs font-normal text-slate-400">| Spatial Intelligence Core</span>
                </h1>
            </div>
            
            <!-- ç³»ç»ŸçŠ¶æ€ -->
            <div class="flex items-center gap-6">
                <div class="flex items-center gap-2">
                    <span class="text-xs text-slate-400">ç¥ç»ç½‘æ ¼</span>
                    <span class="badge badge-green">â— ACTIVE</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="text-xs text-slate-400">æ—¶ç©ºé˜»å°¼</span>
                    <span class="badge badge-blue">{{ dampingStatus }}</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="text-xs text-slate-400">å½“å‰æ—¶é—´</span>
                    <span class="text-xs font-mono text-cyan-400">{{ currentTime }}</span>
                </div>
            </div>
        </header>

        <!-- ä¸»ä½“ï¼šä¸‰æ å¸ƒå±€ -->
        <main class="flex-1 flex overflow-hidden">
            
            <!-- å·¦ä¾§ï¼šå‚æ•°æ§åˆ¶é¢æ¿ -->
            <aside class="w-80 border-r border-slate-700 p-6 flex flex-col gap-6 bg-slate-900/50 overflow-y-auto">
                
                <!-- åœºæ™¯è®¾å®š -->
                <div class="space-y-4">
                    <h3 class="text-sm font-bold text-slate-400 uppercase tracking-widest flex items-center gap-2">
                        <span>ğŸ¯</span>
                        <span>åœºæ™¯è®¾å®š</span>
                    </h3>
                    
                    <div class="glass-panel p-4 rounded-lg space-y-4">
                        <!-- åŸå¸‚é€‰æ‹© -->
                        <div>
                            <label class="text-xs text-slate-400 block mb-2">ç›®çš„åœ°åŸå¸‚</label>
                            <select v-model="city" @change="updateScenario" class="w-full bg-slate-800 border border-slate-700 rounded px-3 py-2 text-sm text-slate-200 focus:outline-none focus:border-blue-500">
                                <option value="è‹å·">è‹å·</option>
                                <option value="æ­å·">æ­å·</option>
                                <option value="å—äº¬">å—äº¬</option>
                            </select>
                        </div>
                        
                        <!-- æ—¶é—´æ»‘å— -->
                        <div>
                            <div class="flex justify-between text-sm mb-2">
                                <span class="text-slate-400">å½“å‰æ—¶é—´</span>
                                <span class="font-mono text-blue-400">{{ currentHour }}:00</span>
                            </div>
                            <input type="range" min="0" max="23" v-model="currentHour" @input="updateScenario" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-500">
                            <div class="flex justify-between text-xs text-slate-500 mt-1">
                                <span>0:00</span>
                                <span>12:00</span>
                                <span>23:00</span>
                            </div>
                        </div>
                        
                        <!-- å¤©æ°”å› å­ -->
                        <div>
                            <div class="flex justify-between text-sm mb-2">
                                <span class="text-slate-400">å¤©æ°”çŠ¶å†µ</span>
                                <span class="font-mono" :class="weatherColorClass">{{ weather }}</span>
                            </div>
                            <div class="grid grid-cols-4 gap-2">
                                <button @click="setWeather('æ™´')" class="py-2 text-lg rounded bg-slate-700 hover:bg-slate-600 transition" :class="{'ring-2 ring-blue-500': weather === 'æ™´'}">â˜€ï¸</button>
                                <button @click="setWeather('å¤šäº‘')" class="py-2 text-lg rounded bg-slate-700 hover:bg-slate-600 transition" :class="{'ring-2 ring-blue-500': weather === 'å¤šäº‘'}">â›…</button>
                                <button @click="setWeather('å°é›¨')" class="py-2 text-lg rounded bg-slate-700 hover:bg-slate-600 transition" :class="{'ring-2 ring-blue-500': weather === 'å°é›¨'}">ğŸŒ§ï¸</button>
                                <button @click="setWeather('æš´é›¨')" class="py-2 text-lg rounded bg-slate-700 hover:bg-slate-600 transition" :class="{'ring-2 ring-blue-500': weather === 'æš´é›¨'}">â›ˆï¸</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æ—¶ç©ºé˜»å°¼ç³»æ•°ç›‘æ§ -->
                <div class="space-y-4">
                    <h3 class="text-sm font-bold text-slate-400 uppercase tracking-widest flex items-center gap-2">
                        <span>ğŸŒ†</span>
                        <span>é˜»å°¼ç³»æ•°å®æ—¶ç›‘æ§</span>
                    </h3>
                    
                    <div class="glass-panel p-4 rounded-lg space-y-3 text-xs">
                        <!-- L_zone -->
                        <div>
                            <div class="flex justify-between mb-1">
                                <span class="text-slate-300">L_zone (åŒºåŸŸå› å­)</span>
                                <span class="font-mono text-yellow-400 font-bold">{{ factors.l_zone.toFixed(2) }}</span>
                            </div>
                            <div class="w-full bg-slate-700 h-2 rounded-full overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-yellow-500 to-yellow-400 transition-all duration-500" :style="{width: (factors.l_zone * 100) + '%'}"></div>
                            </div>
                            <p class="text-slate-500 text-xs mt-1">{{ zoneDescription }}</p>
                        </div>
                        
                        <!-- L_flow -->
                        <div class="pt-2">
                            <div class="flex justify-between mb-1">
                                <span class="text-slate-300">L_flow (æ½®æ±å› å­)</span>
                                <span class="font-mono text-purple-400 font-bold">{{ factors.l_flow.toFixed(2) }}</span>
                            </div>
                            <div class="w-full bg-slate-700 h-2 rounded-full overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-purple-500 to-purple-400 transition-all duration-500" :style="{width: (factors.l_flow * 100) + '%'}"></div>
                            </div>
                            <p class="text-slate-500 text-xs mt-1">{{ flowDescription }}</p>
                        </div>
                        
                        <!-- L_activity -->
                        <div class="pt-2">
                            <div class="flex justify-between mb-1">
                                <span class="text-slate-300">L_activity (æ´»åŠ›å› å­)</span>
                                <span class="font-mono text-green-400 font-bold">{{ factors.l_activity.toFixed(2) }}</span>
                            </div>
                            <div class="w-full bg-slate-700 h-2 rounded-full overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-green-500 to-green-400 transition-all duration-500" :style="{width: (factors.l_activity * 100) + '%'}"></div>
                            </div>
                            <p class="text-slate-500 text-xs mt-1">åŸºäºLBSçƒ­åŠ›å›¾å®æ—¶è®¡ç®—</p>
                        </div>
                        
                        <!-- ç»¼åˆä¿®æ­£ -->
                        <div class="pt-3 border-t border-slate-700">
                            <div class="flex justify-between items-center">
                                <span class="text-slate-300 font-bold">ç»¼åˆä¿®æ­£ç³»æ•°</span>
                                <span class="text-lg font-mono font-bold" :class="finalModifierColorClass">{{ finalModifier.toFixed(2) }}x</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ä½¿ç”¨è¯´æ˜ -->
                <div class="glass-panel p-4 rounded-lg text-xs text-slate-400 space-y-2">
                    <h4 class="font-bold text-slate-300">ğŸ’¡ ä½¿ç”¨è¯´æ˜</h4>
                    <ul class="space-y-1 list-disc list-inside">
                        <li>æ‹–åŠ¨æ—¶é—´æ»‘å—æŸ¥çœ‹ä¸åŒæ—¶æ®µ</li>
                        <li>åˆ‡æ¢å¤©æ°”è§‚å¯Ÿå½±å“</li>
                        <li>ç‚¹å‡»æ‹“æ‰‘èŠ‚ç‚¹å±•å¼€ä¸‹ä¸€æ­¥</li>
                        <li>é¢œè‰²è¶Šç»¿è¶Šæ¨èï¼Œè¶Šçº¢è¶Šä¸æ¨è</li>
                    </ul>
                </div>
            </aside>

            <!-- ä¸­é—´ï¼šECharts æ‹“æ‰‘ç”»å¸ƒ -->
            <section class="flex-1 relative bg-slate-950">
                <!-- èƒŒæ™¯ç½‘æ ¼ -->
                <div class="absolute inset-0 opacity-5" style="background-image: repeating-linear-gradient(0deg, #3b82f6 0px, transparent 1px, transparent 40px), repeating-linear-gradient(90deg, #3b82f6 0px, transparent 1px, transparent 40px);"></div>
                
                <!-- å›¾è¡¨å®¹å™¨ -->
                <div id="graph-container" class="w-full h-full relative z-10"></div>
                
                <!-- AI æç¤ºæ°”æ³¡ -->
                <transition name="fade">
                    <div v-if="aiMessage" class="absolute bottom-8 left-1/2 -translate-x-1/2 glass-panel px-6 py-3 rounded-full flex items-center gap-3 shadow-lg animate-fade-in">
                        <span class="text-2xl">ğŸ¤–</span>
                        <span class="text-sm font-medium text-cyan-300">{{ aiMessage }}</span>
                    </div>
                </transition>
                
                <!-- å›¾ä¾‹ -->
                <div class="absolute top-6 right-6 glass-panel p-4 rounded-lg text-xs space-y-2">
                    <h4 class="font-bold text-slate-300 mb-3">ğŸ¨ è¾¹é¢œè‰²å›¾ä¾‹</h4>
                    <div class="flex items-center gap-2">
                        <div class="w-12 h-1 bg-green-500 rounded"></div>
                        <span class="text-slate-400">ç•…é€š (â‰¥1.0x)</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-12 h-1 bg-yellow-500 rounded"></div>
                        <span class="text-slate-400">ä¸€èˆ¬ (0.6-1.0x)</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-12 h-1 bg-red-500 rounded"></div>
                        <span class="text-slate-400">æ‹¥å µ (<0.6x)</span>
                    </div>
                </div>
            </section>

            <!-- å³ä¾§ï¼šè¯¦æƒ…é¢æ¿ -->
            <aside class="w-96 border-l border-slate-700 p-6 bg-slate-900/50 overflow-y-auto">
                <div v-if="selectedNode" class="space-y-6 animate-fade-in">
                    
                    <!-- POI æ ‡é¢˜å¡ç‰‡ -->
                    <div class="glass-panel rounded-lg overflow-hidden">
                        <div class="h-32 bg-gradient-to-br from-blue-900 to-slate-900 flex items-center justify-center relative">
                            <div class="text-center z-10">
                                <h2 class="text-2xl font-bold text-white mb-2">{{ selectedNode.name }}</h2>
                                <div class="flex gap-2 justify-center flex-wrap">
                                    <span class="badge badge-blue" v-for="tag in selectedNode.tags">{{ tag }}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ç»¼åˆè¯„åˆ† -->
                    <div class="glass-panel p-5 rounded-lg">
                        <div class="flex items-end justify-between border-b border-slate-700 pb-4 mb-4">
                            <div>
                                <div class="text-xs text-slate-400 mb-1">ç»¼åˆæ¨èæŒ‡æ•°</div>
                                <div class="text-5xl font-bold font-mono" :class="scoreColorClass">{{ selectedNode.score.toFixed(2) }}</div>
                            </div>
                            <div class="text-right">
                                <div class="text-xs text-slate-400 mb-1">æ—¶ç©ºé˜»å°¼ä¿®æ­£</div>
                                <div class="text-2xl font-mono font-bold" :class="dampingColorClass">{{ selectedNode.damping_factor.toFixed(2) }}x</div>
                            </div>
                        </div>
                        
                        <!-- è¯„åˆ†ç»„æˆ -->
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span class="text-slate-400">åŸºç¡€è¯„åˆ†</span>
                                <span class="font-mono text-slate-200">{{ selectedNode.base_score.toFixed(2) }}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-slate-400">å¤©æ°”ä¿®æ­£</span>
                                <span class="font-mono" :class="selectedNode.weather_modifier > 1 ? 'text-green-400' : selectedNode.weather_modifier < 1 ? 'text-red-400' : 'text-slate-200'">
                                    {{ selectedNode.weather_modifier.toFixed(2) }}x
                                    {{ selectedNode.weather_modifier > 1 ? 'â¬†ï¸' : selectedNode.weather_modifier < 1 ? 'â¬‡ï¸' : '' }}
                                </span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-slate-400">æ—¶ç©ºä¿®æ­£</span>
                                <span class="font-mono" :class="selectedNode.damping_factor >= 1 ? 'text-green-400' : selectedNode.damping_factor >= 0.6 ? 'text-yellow-400' : 'text-red-400'">
                                    {{ selectedNode.damping_factor.toFixed(2) }}x
                                    {{ selectedNode.damping_factor >= 1 ? 'ğŸŸ¢' : selectedNode.damping_factor >= 0.6 ? 'ğŸŸ¡' : 'ğŸ”´' }}
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- AI å†³ç­–é€»è¾‘ -->
                    <div class="glass-panel p-4 rounded-lg space-y-3">
                        <h4 class="text-sm font-bold text-slate-300 flex items-center gap-2">
                            <span>ğŸ§ </span>
                            <span>AI å†³ç­–é€»è¾‘</span>
                        </h4>
                        <div class="p-3 rounded bg-slate-800/50 border border-slate-700 text-sm leading-relaxed text-slate-300">
                            {{ selectedNode.reason }}
                        </div>
                    </div>

                    <!-- æ‹¥å µç†”æ–­è­¦å‘Š -->
                    <div v-if="selectedNode.is_blocked" class="glass-panel p-4 rounded-lg bg-red-900/20 border border-red-500/50">
                        <div class="flex gap-3 items-start">
                            <span class="text-2xl">â›”</span>
                            <div>
                                <h5 class="font-bold text-red-400 text-sm uppercase mb-2">Congestion Circuit Breaker</h5>
                                <p class="text-sm text-red-200 leading-relaxed">{{ selectedNode.block_reason }}</p>
                            </div>
                        </div>
                    </div>

                    <!-- å››é¡¹åŸåˆ™éªŒè¯ -->
                    <div class="glass-panel p-4 rounded-lg space-y-3">
                        <h4 class="text-sm font-bold text-slate-300 flex items-center gap-2">
                            <span>ğŸ”</span>
                            <span>å››é¡¹åŸåˆ™éªŒè¯</span>
                        </h4>
                        <div class="grid grid-cols-2 gap-3 text-xs">
                            <div class="bg-slate-800/50 p-3 rounded">
                                <div class="text-slate-400 mb-1">æ•°æ®ä¸€è‡´æ€§</div>
                                <div class="font-mono font-bold text-green-400">{{ selectedNode.verification.consistency }}%</div>
                            </div>
                            <div class="bg-slate-800/50 p-3 rounded">
                                <div class="text-slate-400 mb-1">è™šå‡ç‡</div>
                                <div class="font-mono font-bold text-blue-400">{{ selectedNode.verification.fake_rate }}%</div>
                            </div>
                            <div class="bg-slate-800/50 p-3 rounded">
                                <div class="text-slate-400 mb-1">ç©ºé—´åˆç†æ€§</div>
                                <div class="font-mono font-bold text-yellow-400">{{ selectedNode.verification.spatial }}</div>
                            </div>
                            <div class="bg-slate-800/50 p-3 rounded">
                                <div class="text-slate-400 mb-1">æ—¶é—´å¯è¡Œæ€§</div>
                                <div class="font-mono font-bold text-purple-400">{{ selectedNode.verification.temporal }}</div>
                            </div>
                        </div>
                    </div>

                    <!-- æœªæ¥é¢„è§ˆ -->
                    <div v-if="selectedNode.future_preview && selectedNode.future_preview.length > 0" class="glass-panel p-4 rounded-lg">
                        <h4 class="text-sm font-bold text-slate-300 flex items-center gap-2 mb-3">
                            <span>ğŸ”®</span>
                            <span>é€‰æ‹©åå¯èƒ½å»</span>
                        </h4>
                        <div class="flex flex-wrap gap-2">
                            <span v-for="poi in selectedNode.future_preview" class="badge badge-green">{{ poi }}</span>
                        </div>
                    </div>
                </div>
                
                <div v-else class="h-full flex flex-col items-center justify-center text-slate-600 space-y-4">
                    <svg class="w-24 h-24 text-slate-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"></path>
                    </svg>
                    <div class="text-center">
                        <p class="font-medium text-slate-500">ç‚¹å‡»æ‹“æ‰‘èŠ‚ç‚¹</p>
                        <p class="text-sm text-slate-600">æŸ¥çœ‹ AI åˆ†æè¯¦æƒ…</p>
                    </div>
                </div>
            </aside>

        </main>
    </div>

    <script>
        const { createApp, ref, onMounted, computed, watch } = Vue;

        createApp({
            setup() {
                // ========== çŠ¶æ€ç®¡ç† ==========
                const city = ref('è‹å·');
                const currentHour = ref(14);
                const weather = ref('å°é›¨');
                const selectedNode = ref(null);
                const aiMessage = ref('');
                
                // é˜»å°¼å› å­
                const factors = ref({
                    l_zone: 1.0,
                    l_flow: 1.0,
                    l_activity: 1.1
                });

                // ========== è®¡ç®—å±æ€§ ==========
                const currentTime = computed(() => `${String(currentHour.value).padStart(2, '0')}:00`);
                
                const weatherColorClass = computed(() => {
                    return weather.value === 'æ™´' ? 'text-yellow-400' :
                           weather.value === 'å¤šäº‘' ? 'text-slate-400' :
                           'text-blue-400';
                });
                
                const scoreColorClass = computed(() => {
                    if (!selectedNode.value) return '';
                    const score = selectedNode.value.score;
                    return score >= 0.8 ? 'text-green-400' :
                           score >= 0.6 ? 'text-yellow-400' :
                           'text-red-400';
                });
                
                const dampingColorClass = computed(() => {
                    if (!selectedNode.value) return '';
                    const damping = selectedNode.value.damping_factor;
                    return damping >= 1.0 ? 'text-green-400' :
                           damping >= 0.6 ? 'text-yellow-400' :
                           'text-red-400';
                });
                
                const finalModifier = computed(() => {
                    return factors.value.l_zone * factors.value.l_flow * factors.value.l_activity;
                });
                
                const finalModifierColorClass = computed(() => {
                    const modifier = finalModifier.value;
                    return modifier >= 1.0 ? 'text-green-400' :
                           modifier >= 0.6 ? 'text-yellow-400' :
                           'text-red-400';
                });
                
                const dampingStatus = computed(() => {
                    const modifier = finalModifier.value;
                    return modifier >= 1.0 ? 'ğŸŸ¢ ç•…é€š' :
                           modifier >= 0.6 ? 'ğŸŸ¡ ä¸€èˆ¬' :
                           'ğŸ”´ æ‹¥å µ';
                });
                
                const zoneDescription = computed(() => {
                    const zone = factors.value.l_zone;
                    return zone >= 1.0 ? 'æ™®é€šåŒºåŸŸï¼Œé€šè¡Œæ­£å¸¸' :
                           zone >= 0.6 ? 'CBDåŒºåŸŸï¼Œè½»åº¦æ‹¥å µ' :
                           'CBDåŒºåŸŸï¼Œä¸¥é‡æ‹¥å µ';
                });
                
                const flowDescription = computed(() => {
                    const flow = factors.value.l_flow;
                    const hour = currentHour.value;
                    if (hour >= 7 && hour <= 9) return 'æ—©é«˜å³°è¿›åŸæ–¹å‘';
                    if (hour >= 17 && hour <= 19) return 'æ™šé«˜å³°å‡ºåŸæ–¹å‘';
                    return 'éé«˜å³°æ—¶æ®µï¼Œé€šè¡Œé¡ºç•…';
                });

                // ========== Mock æ•°æ® ==========
                const mockData = {
                    nodes: [
                        {
                            id: '0',
                            name: 'è‹å·ç«™',
                            symbolSize: 60,
                            itemStyle: { color: '#3b82f6' },
                            x: 150,
                            y: 300,
                            tags: ['èµ·ç‚¹', 'äº¤é€šæ¢çº½'],
                            score: 1.0,
                            base_score: 1.0,
                            weather_modifier: 1.0,
                            damping_factor: 1.0,
                            reason: 'å‡ºå‘ç‚¹ï¼Œæ— éœ€è¯„åˆ†',
                            verification: { consistency: 100, fake_rate: 0, spatial: 1.0, temporal: 1.0 },
                            future_preview: []
                        },
                        {
                            id: '1',
                            name: 'æ‹™æ”¿å›­',
                            symbolSize: 50,
                            itemStyle: { color: '#10b981' },
                            x: 400,
                            y: 200,
                            tags: ['å›­æ—', '5Aæ™¯åŒº', 'æˆ·å¤–'],
                            score: 0.56,
                            base_score: 0.80,
                            weather_modifier: 0.70,
                            damping_factor: 1.00,
                            reason: 'æ±Ÿå—å›­æ—ä»£è¡¨ä½œï¼Œé›¨å¤©æ™¯è‰²åˆ«æœ‰éŸµå‘³ï¼Œä½†æˆ·å¤–æ¸¸è§ˆä¼šå—å½±å“ã€‚å»ºè®®æºå¸¦é›¨å…·æˆ–æ”¹æ—¥å†è®¿ã€‚',
                            verification: { consistency: 96, fake_rate: 0, spatial: 0.82, temporal: 0.84 },
                            future_preview: ['å¹³æ±Ÿè·¯', 'ç‹®å­æ—', 'è‹å·åšç‰©é¦†'],
                            is_blocked: false
                        },
                        {
                            id: '2',
                            name: 'è‹å·åšç‰©é¦†',
                            symbolSize: 50,
                            itemStyle: { color: '#10b981' },
                            x: 400,
                            y: 300,
                            tags: ['åšç‰©é¦†', 'å®¤å†…', 'æ–‡åŒ–'],
                            score: 0.96,
                            base_score: 0.80,
                            weather_modifier: 1.20,
                            damping_factor: 1.00,
                            reason: 'è´è¿é“­è®¾è®¡çš„ç°ä»£åšç‰©é¦†ï¼Œé›¨å¤©å‚è§‚æ›´ä½³ã€‚å®¤å†…åœºé¦†ä¸å—å¤©æ°”å½±å“ï¼Œæ˜¯å½“å‰åœºæ™¯çš„æœ€ä¼˜é€‰æ‹©ã€‚',
                            verification: { consistency: 96, fake_rate: 0, spatial: 0.82, temporal: 0.84 },
                            future_preview: ['æ‹™æ”¿å›­', 'å¹³æ±Ÿè·¯', 'ç‹®å­æ—'],
                            is_blocked: false
                        },
                        {
                            id: '3',
                            name: 'é‡‘é¸¡æ¹–CBD',
                            symbolSize: 45,
                            itemStyle: { color: '#ef4444' },
                            x: 400,
                            y: 400,
                            tags: ['CBD', 'å•†ä¸š', 'æ‹¥å µ'],
                            score: 0.27,
                            base_score: 0.80,
                            weather_modifier: 1.00,
                            damping_factor: 0.33,
                            reason: 'CBDå•†ä¸šåŒºï¼Œæ™šé«˜å³°ä¸¥é‡æ‹¥å µã€‚ç³»ç»Ÿæ£€æµ‹åˆ°æ½®æ±æ•ˆåº”ï¼Œè§¦å‘æ‹¥å µç†”æ–­æœºåˆ¶ã€‚',
                            verification: { consistency: 95, fake_rate: 0, spatial: 0.80, temporal: 0.85 },
                            future_preview: ['è¯šå“ä¹¦åº—', 'åœ†èå¹¿åœº'],
                            is_blocked: true,
                            block_reason: 'æ™šé«˜å³°è¿›åŸæ–¹å‘ä¸¥é‡æ‹¥å µï¼ˆL_zone=0.3ï¼‰ï¼Œç³»ç»Ÿå·²è§¦å‘è‡ªåŠ¨ç†”æ–­ã€‚å»ºè®®é¿å¼€17:00-19:00æ—¶æ®µï¼Œæˆ–é€‰æ‹©å…¶ä»–ç›®çš„åœ°ã€‚'
                        }
                    ],
                    links: [
                        { source: '0', target: '1', lineStyle: { width: 2, color: '#fbbf24' } },
                        { source: '0', target: '2', lineStyle: { width: 3, color: '#10b981' } },
                        { source: '0', target: '3', lineStyle: { width: 1, color: '#ef4444', type: 'dashed' } }
                    ]
                };

                // ECharts å®ä¾‹
                let chart = null;

                // ========== æ–¹æ³• ==========
                
                const initChart = () => {
                    chart = echarts.init(document.getElementById('graph-container'));
                    updateChart();
                    
                    // ç›‘å¬ç‚¹å‡»äº‹ä»¶
                    chart.on('click', (params) => {
                        if (params.dataType === 'node') {
                            selectedNode.value = params.data;
                            
                            // æ¨¡æ‹Ÿç‚¹å‡»åçš„æ‹“æ‰‘å±•å¼€æç¤º
                            if (params.data.id === '1' || params.data.id === '2') {
                                aiMessage.value = 'ğŸ§  æ­£åœ¨ä¸ºæ‚¨è®¡ç®—ä¸‹ä¸€æ­¥çš„æœ€ä¼˜è§£...';
                                setTimeout(() => { 
                                    aiMessage.value = `ğŸ’¡ ä»"${params.data.name}"å‡ºå‘ï¼Œå·²ä¸ºæ‚¨ç”Ÿæˆ ${params.data.future_preview.length} ä¸ªå€™é€‰åœ°ç‚¹`;
                                    setTimeout(() => { aiMessage.value = ''; }, 3000);
                                }, 1000);
                            }
                        }
                    });
                };
                
                const updateChart = () => {
                    if (!chart) return;
                    
                    // æ›´æ–°è¾¹çš„é¢œè‰²å’Œç²—ç»†ï¼ˆåŸºäºé˜»å°¼ç³»æ•°ï¼‰
                    const updatedLinks = mockData.links.map(link => {
                        const targetNode = mockData.nodes.find(n => n.id === link.target);
                        if (!targetNode) return link;
                        
                        const damping = targetNode.damping_factor;
                        const color = damping >= 1.0 ? '#10b981' : 
                                     damping >= 0.6 ? '#fbbf24' : 
                                     '#ef4444';
                        const width = damping >= 1.0 ? 3 : 
                                     damping >= 0.6 ? 2 : 
                                     1;
                        const type = damping < 0.6 ? 'dashed' : 'solid';
                        
                        return {
                            ...link,
                            lineStyle: { width, color, type, curveness: 0.2 }
                        };
                    });
                    
                    const option = {
                        tooltip: { show: false },
                        animationDurationUpdate: 1000,
                        animationEasingUpdate: 'cubicInOut',
                        series: [{
                            type: 'graph',
                            layout: 'none',
                            symbolSize: 50,
                            roam: true,
                            label: {
                                show: true,
                                position: 'bottom',
                                color: '#e2e8f0',
                                fontSize: 12,
                                fontWeight: 'bold',
                                formatter: '{b}'
                            },
                            edgeSymbol: ['circle', 'arrow'],
                            edgeSymbolSize: [4, 10],
                            data: mockData.nodes,
                            links: updatedLinks,
                            lineStyle: {
                                opacity: 0.9,
                                curveness: 0.2
                            },
                            emphasis: {
                                focus: 'adjacency',
                                label: {
                                    fontSize: 14
                                },
                                lineStyle: {
                                    width: 4
                                }
                            }
                        }]
                    };
                    
                    chart.setOption(option);
                };
                
                const updateScenario = () => {
                    const hour = parseInt(currentHour.value);
                    
                    // æ›´æ–°é˜»å°¼å› å­
                    if (hour >= 17 && hour <= 19) {
                        // æ™šé«˜å³°
                        factors.value = {
                            l_zone: 0.30,  // CBDä¸¥é‡æ‹¥å µ
                            l_flow: 1.00,
                            l_activity: 1.10
                        };
                        aiMessage.value = 'âš ï¸ æ£€æµ‹åˆ°æ™šé«˜å³°ï¼CBDåŒºåŸŸå·²è§¦å‘æ‹¥å µç†”æ–­ã€‚';
                        setTimeout(() => { aiMessage.value = ''; }, 3000);
                        
                        // æ›´æ–°èŠ‚ç‚¹æ•°æ®
                        mockData.nodes[3].damping_factor = 0.33;
                        mockData.nodes[3].score = 0.27;
                        mockData.nodes[3].is_blocked = true;
                        
                    } else if (hour >= 7 && hour <= 9) {
                        // æ—©é«˜å³°
                        factors.value = {
                            l_zone: 0.60,
                            l_flow: 1.00,
                            l_activity: 1.10
                        };
                        mockData.nodes[3].damping_factor = 0.66;
                        mockData.nodes[3].score = 0.53;
                        mockData.nodes[3].is_blocked = false;
                        
                    } else {
                        // éé«˜å³°
                        factors.value = {
                            l_zone: 1.00,
                            l_flow: 1.00,
                            l_activity: 1.10
                        };
                        mockData.nodes[3].damping_factor = 1.10;
                        mockData.nodes[3].score = 0.88;
                        mockData.nodes[3].is_blocked = false;
                    }
                    
                    updateChart();
                };
                
                const setWeather = (w) => {
                    weather.value = w;
                    
                    // æ›´æ–°å¤©æ°”ä¿®æ­£
                    if (w === 'æ™´') {
                        mockData.nodes[1].weather_modifier = 1.20;  // æ‹™æ”¿å›­ æ™´å¤©åŠ åˆ†
                        mockData.nodes[1].score = 0.96;
                        mockData.nodes[2].weather_modifier = 1.00;  // åšç‰©é¦† æ™´å¤©æ­£å¸¸
                        mockData.nodes[2].score = 0.80;
                        aiMessage.value = 'â˜€ï¸ æ™´å¤©ï¼æˆ·å¤–æ™¯ç‚¹è¯„åˆ†å·²æå‡ã€‚';
                    } else if (w === 'å°é›¨' || w === 'å¤šäº‘') {
                        mockData.nodes[1].weather_modifier = 0.70;  // æ‹™æ”¿å›­ é›¨å¤©é™åˆ†
                        mockData.nodes[1].score = 0.56;
                        mockData.nodes[2].weather_modifier = 1.20;  // åšç‰©é¦† é›¨å¤©åŠ åˆ†
                        mockData.nodes[2].score = 0.96;
                        aiMessage.value = 'ğŸŒ§ï¸ é›¨å¤©ï¼å·²ä¸ºæ‚¨ä¼˜å…ˆæ¨èå®¤å†…åœºé¦†ã€‚';
                    } else if (w === 'æš´é›¨') {
                        mockData.nodes[1].weather_modifier = 0.50;
                        mockData.nodes[1].score = 0.40;
                        mockData.nodes[2].weather_modifier = 1.30;
                        mockData.nodes[2].score = 1.04;
                        aiMessage.value = 'â›ˆï¸ æš´é›¨é¢„è­¦ï¼å·²å¤§å¹…é™ä½æˆ·å¤–æ™¯ç‚¹æƒé‡ã€‚';
                    }
                    
                    setTimeout(() => { aiMessage.value = ''; }, 3000);
                    updateChart();
                };

                // ========== ç”Ÿå‘½å‘¨æœŸ ==========
                onMounted(() => {
                    initChart();
                    
                    // å“åº”çª—å£å¤§å°å˜åŒ–
                    window.addEventListener('resize', () => {
                        if (chart) chart.resize();
                    });
                    
                    // åˆå§‹åŒ–æ—¶æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
                    aiMessage.value = 'ğŸ¯ ç³»ç»Ÿå·²å°±ç»ªï¼Œè°ƒæ•´å‚æ•°è§‚å¯Ÿé˜»å°¼ç³»æ•°å˜åŒ–';
                    setTimeout(() => { aiMessage.value = ''; }, 3000);
                });

                return {
                    // çŠ¶æ€
                    city,
                    currentHour,
                    weather,
                    selectedNode,
                    aiMessage,
                    factors,
                    
                    // è®¡ç®—å±æ€§
                    currentTime,
                    weatherColorClass,
                    scoreColorClass,
                    dampingColorClass,
                    finalModifier,
                    finalModifierColorClass,
                    dampingStatus,
                    zoneDescription,
                    flowDescription,
                    
                    // æ–¹æ³•
                    updateScenario,
                    setWeather
                };
            }
        }).mount('#app');
    </script>
</body>
</html>

# 🤖 JARVIS Travel Command Center - 完整使用指南

## 🎮 交互流程（5步完成规划）

```
┌────────────────────────────────────────────────────────┐
│  第1步：🚀 START MISSION                               │
│  ↓                                                     │
│  • 点击左下角 "🚀 START MISSION" 按钮                  │
│  • 看到：Session created: session_0                   │
│  • 地图显示起点标记（苏州站）                          │
│  • AI核心显示："➡️ NEXT STEP"                        │
│  • 提示："👉 点击 GET OPTIONS 按钮获取AI推荐"         │
└────────────────────────────────────────────────────────┘
           ↓
┌────────────────────────────────────────────────────────┐
│  第2步：➡️ GET OPTIONS                                 │
│  ↓                                                     │
│  • 点击 "➡️ GET OPTIONS" 按钮                         │
│  • DeepSeek AI开始推理（约2-3秒）                     │
│  • 看到：                                              │
│    - 🗺️ 地图显示所有候选点（1-9号标记）              │
│    - 📋 右侧时间轴出现选项列表                        │
│    - 📊 左侧雷达图显示第一个选项的张力                │
│    - 📦 右下角显示推荐卡片（Top 3）                   │
│  • AI核心显示："💡 PLEASE SELECT"                    │
│  • 提示："👆 点击时间轴或推荐卡片查看详情，然后..."   │
└────────────────────────────────────────────────────────┘
           ↓
┌────────────────────────────────────────────────────────┐
│  第3步：👆 选择查看详情                                │
│  ↓                                                     │
│  • 方式A：点击右侧时间轴任意选项                       │
│  • 方式B：点击右下角推荐卡片                          │
│  • 效果：                                              │
│    - 🎯 时间轴选中项高亮（青色边框）                  │
│    - 📊 雷达图实时更新为该选项的5维张力               │
│    - 💭 AI解释更新为该选项的说明                      │
│    - 🗺️ 地图自动聚焦到该POI位置（zoom=15）           │
│    - 📝 终端日志显示："✅ Selected: #X 景点名"        │
│  • AI核心显示："🎯 SELECTED #X"                      │
│                                                        │
│  💡 可以多次点击对比不同选项！                        │
└────────────────────────────────────────────────────────┘
           ↓
┌────────────────────────────────────────────────────────┐
│  第4步：✅ CONFIRM                                      │
│  ↓                                                     │
│  • 点击 "✅ CONFIRM" 按钮确认前往                     │
│  • 系统执行：                                          │
│    - 📍 更新当前位置                                   │
│    - 💰 扣除费用                                       │
│    - ⏰ 增加时间                                       │
│    - 🗺️ 地图更新标记到新位置                         │
│    - 📝 记录区域访问次数                              │
│  • 自动触发：1秒后自动执行第5步                       │
└────────────────────────────────────────────────────────┘
           ↓
┌────────────────────────────────────────────────────────┐
│  第5步：🔄 自动获取下一步（循环）                      │
│  ↓                                                     │
│  • 系统自动调用 getNextOptions()                      │
│  • 重复第2-4步，直到：                                │
│    - 时间用完                                          │
│    - 预算用完                                          │
│    - 无更多候选                                        │
│  • 最终显示："MISSION COMPLETE"                       │
└────────────────────────────────────────────────────────┘
```

---

## 🎨 界面元素说明

### 左栏：态势感知

| 元素 | 功能 | 交互 |
|------|------|------|
| **张力雷达图** | 5维可视化当前选项的内心冲突 | 自动更新 |
| **终端日志** | 显示系统操作记录 | 自动滚动 |
| **系统控制** | 3个操作按钮 | 手动点击 |

#### 雷达图5个维度
1. **冲突度** (0-100) - 内心矛盾程度
2. **新鲜感** (0-100) - 探索vs重复
3. **体力需求** (0-100) - 当前时间的体力消耗
4. **连续性** (0-100) - 类型切换vs单调
5. **风险** (0-100) - 时间/预算风险

---

### 中栏：核心指挥

| 元素 | 功能 | 显示内容 |
|------|------|---------|
| **高德地图** | 实时显示位置和候选点 | 深色风格3D地图 |
| **AI核心** | 显示当前状态和建议 | 动态文本+脉冲动画 |

#### 地图显示逻辑
- **START后**：显示起点（绿色标记）
- **GET OPTIONS后**：显示所有候选点（1-9号标记）
- **点击选项后**：聚焦到该点（zoom=15）
- **CONFIRM后**：移动到新位置

---

### 右栏：行动方案

| 元素 | 功能 | 交互方式 |
|------|------|---------|
| **时间轴** | 显示所有候选选项详情 | 点击选择 |
| **推荐卡片** | Top 3快速查看 | 点击选择 |

#### 时间轴信息
```
#1 🏛️ 苏州博物馆 (✨ 新)
   📍 姑苏 | taxi 27分钟
   ⭐ 0.85 | 🌌 W轴: 0.75 | ⚔️ 冲突: 0.33
   💭 我觉得可以去...虽然不知道是不是会太正式
```

---

## 🔥 核心功能详解

### 1. DeepSeek AI解释（犹豫化）

**低冲突**：
```
💭 我觉得可以去苏州博物馆看看，虽然不知道是不是会太正式
```

**高冲突（重复访问）**：
```
💭 姑苏又去？或者其他那边还没怎么去过，要不换个地方透透气？
```

**第二名的不甘心**：
```
💭 虽然排第二，但姑苏是新地方，说不定更有惊喜
```

---

### 2. 张力可视化

**示例：苏州博物馆**
```
冲突度: 33  ⚔️  （有点纠结）
新鲜感: 80  ✨  （新地方）
体力需求: 40 💪  （适中）
连续性: -20 🔗  （类型重复）
风险: 10   ⚠️  （安全）
```

**雷达图效果**：
- 🔴 红色区域大 = 高冲突
- 🔵 蓝色区域大 = 低冲突

---

### 3. 区域访问跟踪

| 状态 | 显示 | AI反应 |
|------|------|--------|
| 首次访问 | `(✨ 新)` | "新地方总归有点新鲜感" |
| 第2次 | `(🔄 第2次)` | "虽然有点重复，但..." |
| 第3次+ | `(🔄 第N次)` | "又去？要不换个地方？" |

---

## 💡 使用技巧

### 技巧1：对比选项
```
1. 点击 #1 → 查看雷达图
2. 点击 #2 → 对比雷达图
3. 点击 #3 → 再次对比
4. 选择冲突度最低/新鲜感最高的
```

### 技巧2：查看地图分布
```
GET OPTIONS后 → 地图自动显示所有点
→ 可以看到地理分布
→ 避免来回折返
```

### 技巧3：阅读AI犹豫
```
AI说："虽然...但是..."
→ 表示有内心矛盾
→ 冲突度 > 30
→ 可以考虑第二选择
```

### 技巧4：关注终端日志
```
> W轴批量推理...
> ✅ W轴推理完成: 9个 (2.06秒)
> 平均冲突度: 0.33（低冲突）
→ 看到系统透明化推理过程
```

---

## 🐛 常见问题

### Q1: 点击时间轴/推荐卡片没反应？
**A**: 检查是否已点击 GET OPTIONS。必须先获取选项才能选择。

### Q2: 地图不显示标记？
**A**: 
1. 检查浏览器控制台（F12）是否有错误
2. 确认高德API加载成功
3. 刷新页面重试

### Q3: CONFIRM后地图不更新？
**A**: 已修复！现在会自动显示新位置标记。

### Q4: AI解释都是一样的？
**A**: 确认LLM配置：
```python
# llm_config.py
LLM_PROVIDER = "deepseek"  # 不是 "mock"
LLM_API_KEY = "sk-..."      # 有效的key
```

### Q5: 雷达图不更新？
**A**: 点击时间轴选项时会自动更新。如果不更新，刷新页面。

---

## 📊 数据流示例

### 完整的一次选择

**1. 后端返回**：
```json
{
  "rank": 1,
  "name": "苏州博物馆",
  "lat": 31.3254,
  "lon": 120.6198,
  "score": 0.85,
  "w_axis": 0.75,
  "tensions": {
    "novelty": 0.8,
    "continuity": -0.2,
    "energy": 0.6,
    "conflict": 0.33
  },
  "explanation": "我觉得可以去...虽然不知道是不是...",
  "region": "姑苏",
  "visit_count": 0
}
```

**2. 前端显示**：
- 🗺️ 地图：标记#1在(120.6198, 31.3254)
- 📋 时间轴：`#1 🏛️ 苏州博物馆 (✨ 新)`
- 📊 雷达图：冲突33, 新鲜80, 体力40...
- 💭 AI：`我觉得可以去...虽然不知道是不是...`

**3. 点击后**：
- 🎯 高亮：时间轴#1青色边框
- 🗺️ 聚焦：地图zoom到15，中心移到苏州博物馆
- 📝 日志：`✅ Selected: #1 苏州博物馆`

**4. CONFIRM后**：
- 📍 位置更新：移动到苏州博物馆
- 💰 预算：5000 → 4953
- ⏰ 时间：0 → 1.9小时
- 🗺️ 标记：地图显示新位置
- 🔄 自动获取下一步

---

## 🎊 完整体验流程示例

### 苏州3日游示例

```
Day 1 - 第1站
1️⃣ START MISSION
   → 📍 苏州站

2️⃣ GET OPTIONS
   → 9个候选（苏州博物馆、拙政园、虎丘...）
   → 地图显示所有点

3️⃣ 点击 #1 苏州博物馆
   → 雷达图：冲突33, 新鲜80
   → AI："我觉得可以去...虽然不知道是不是会太正式"
   
4️⃣ CONFIRM
   → 前往苏州博物馆
   → 花费：¥47, 时间：1.9h
   → 地图定位到博物馆

5️⃣ 自动GET OPTIONS
   → 新的9个候选
   → AI注意到：姑苏区已访问1次

Day 1 - 第2站
3️⃣ 点击 #2 平江路
   → AI："虽然也在姑苏，但是历史街区体验不同..."
   
4️⃣ CONFIRM
   → 前往平江路
   → 区域计数：姑苏 = 2

5️⃣ 自动GET OPTIONS
   → AI开始质疑："姑苏又去？要不换个地方透透气？"

Day 1 - 第3站
3️⃣ 查看AI建议
   → 第一名（姑苏）："虽然有点重复..."
   → 第二名（工业园区）："虽然排第二，但是新地方，说不定更有惊喜"
   → 冲突度：第一名 0.45 vs 第二名 0.12

4️⃣ 选择第二名
   → CONFIRM工业园区选项
   → 探索新区域！

... 继续3天行程 ...
```

---

## 🚀 高级功能

### 功能1：路径优化
系统自动考虑：
- 距离最短
- 时间合理
- 预算控制
- 区域平衡

### 功能2：风险提示
当出现风险时：
- 雷达图风险维度 > 50
- AI解释会说明风险
- 可以选择忽略或调整

### 功能3：动态调整
系统会根据：
- 已访问区域
- 剩余时间
- 剩余预算
- 用户偏好

自动调整推荐权重。

---

## 🎯 核心设计理念

> **"不是替用户决策，而是陪用户犹豫"**

### 体现方式

1. **AI解释犹豫化**
   - ❌ "最佳选择是..."
   - ✅ "我觉得可以...虽然不知道..."

2. **突出第二选择**
   - 给备选一个"申辩"机会
   - "虽然排第二，但..."

3. **可视化矛盾**
   - 雷达图显示冲突度
   - 让用户看到内心纠结

4. **交还选择权**
   - 不自动选择
   - 必须用户点击CONFIRM

---

**享受像钢铁侠一样智能的旅行规划！** 🤖✨

*Powered by 4D Spatial Intelligence Engine + DeepSeek AI*
